window.neko=function(){var a,b=document.getElementById(neko.config.bind.fileId).files[0],c=new FileReader;b&&(a=b.slice(),neko.output.fileBlob=a,document.getElementById(neko.config.bind.nameFieldId).value=b.name,c.onloadend=function(){c.readyState===FileReader.DONE&&(neko.output.parsedData=neko.parse(new Uint8Array(c.result)),neko.render(neko.output.parsedData),neko.helper.hookEvents())},c.readAsArrayBuffer(a))},neko.output={},neko.config={bind:{fileId:"file",nameFieldId:"filename",outputId:"output",saveButtonId:"save",versionId:"version"},lineWidth:55,version:"Revision 8.5"},neko.exportScript=function(a){var b,c="";if(neko.output.parsedData){a=a||document.getElementById("filename").value;for(var d=0;d<neko.output.parsedData.length;d++)if(neko.output.parsedData[d].important){b="";for(var e=0;e<neko.output.parsedData[d].data.length-1;e++)b+=neko.helper.conversion.intToHex(neko.output.parsedData[d].data[e])+" ";b=neko.replace(b),c+=neko.helper.conversion.hexToString(b.hex)+"\r\n"}saveAs(new Blob([c]),a)}},neko.filter=function(a){for(var b,c=0;c<neko.filter.list.length;c++)if(b=neko.filter.list[c],neko.helper.compare(a.subarray(0,b.length),b.filter)!==b.is)return!1;return!0},neko.filter.list=[],neko.filter.add=function(a,b,c){var d=neko.helper.generateKeyFromHex(a);return neko.filter.list.push({name:c||"",filter:d.key,length:d.length,is:b||!1}),neko.filter.list.length-1},neko.filter.remove=function(a){neko.filter.list.splice(a,1)},neko.helper={hookEvents:function(){for(var a=document.getElementsByClassName("data-container"),b=0;b<a.length;b++)a[b].addEventListener("change",function(a){var b=neko.output.parsedData[a.target.getAttribute("data-object")];b.changed=!0})},compare:function(a,b){return b="object"==typeof b?neko.helper.joinArray(b,""):b,a="object"==typeof a?neko.helper.joinArray(a,""):a,a===b},joinArray:function(a,b){var c="";b="string"!=typeof b?",":b;for(var d=0;d<a.length-1;d++)c+=""+a[d]+b;return c+=""+a[d]},getLengthFromWord:function(a){for(var b="",c=a.length-1;c>=0;c--)b+=(2===neko.helper.conversion.intToHex(a[c]).length?"":"0")+neko.helper.conversion.intToHex(a[c]);return neko.helper.conversion.hexToInt(b)},getWordFromLength:function(a){for(var b=neko.helper.conversion.intToHex(a),c=b.match(/.{1,2}/g).reverse(),d=0;d<c.length;d++)c[d]=neko.helper.conversion.hexToInt(c[d]);for(;c.length<4;)c.push(0);return c},generateKeyFromHex:function(a){var b;a=a.split(" "),b=a.length;for(var c=0;c<a.length;c++)a[c]=neko.helper.conversion.hexToInt(a[c]);return{key:neko.helper.joinArray(a,""),length:b}},wrapLines:function(a){for(var b=neko.config.lineWidth,c=a.trim().replace(/\\n/g," \\n ").split(" "),d="",e=0;e<c.length;++e)"\\n"===c[e]?(d+="\n",b=neko.config.lineWidth):c[e].length+1>b?(d+="\n"+c[e]+" ",b=neko.config.lineWidth-(c[e].length+1)):(d+=c[e]+" ",b-=c[e].length+1);return d.trim()},conversion:{intToHex:function(a){return(a.toString(16).length%2===0?a.toString(16):"0"+a.toString(16)).toUpperCase().match(/[0-9A-F]{2}/g).join(" ")},hexToInt:function(a){return parseInt(a,16)},stringToHex:function(a){for(var b="",c=0;c<a.length;c++)b+=(neko._unicode_to_sjis[a.charCodeAt(c)]||"00")+" ";return b.trim()},hexToString:function(a){var b="",c="";a=a.toUpperCase().replace(/[^0-9A-F]+/g,"");for(var d=0;d<a.length;d+=2)b=a.substring(d,d+2),isNaN(neko._sjis_to_unicode[b])&&(b=a.substring(d,d+4),isNaN(neko._sjis_to_unicode[b])?(console.error("Missingno: "+b),b="?"):d+=2),c+=String.fromCharCode(neko._sjis_to_unicode[b]);return c}}},neko.init=function(a){"object"==typeof a&&(neko.config.bind.fileId=a.fileId||neko.config.bind.fileId,neko.config.bind.nameFieldId=a.nameFieldId||neko.config.bind.nameFieldId,neko.config.bind.outputId=a.outputId||neko.config.bind.outputId,neko.config.bind.saveButtonId=a.saveButtonId||neko.config.bind.saveButtonId,neko.config.bind.versionId=a.versionId||neko.config.bind.versionId),document.getElementById(neko.config.bind.versionId).innerText=neko.config.version,document.getElementById(neko.config.bind.fileId).addEventListener("change",neko),document.getElementById(neko.config.bind.saveButtonId).addEventListener("click",neko.save)},neko.parse=function(a){for(var b,c=0,d=[],e=0;c<a.length;)if(91===a[c]&&neko.helper.compare(a.subarray(c,c+15),"911311011317613188131103149921421669332")){for(c-=4,b=c,d.push(neko.set.garbage(a,e,b));1!==a[c]||!neko.helper.compare(a.subarray(c,c+10),"1000010000");)d.push(neko.set.part(a,c)),c+=d[d.length-1].data.length+4;e=c}else c++;return d.push(neko.set.garbage(a,e,c)),d},neko.render=function(a){var b,c,d=document.getElementById(neko.config.bind.outputId),e="";d.remove(),d=document.createElement("div"),d.id=neko.config.bind.outputId;for(var f=0;f<a.length;f++)if(a[f].important){e="";for(var g=0;g<a[f].data.length-1;g++)e+=neko.helper.conversion.intToHex(a[f].data[g])+" ";e=neko.replace(e),e.replaced&&(a[f].changed=!0),b=document.createElement("input"),b.type="text",b.maxlength=220,b.className="data-container",b.id="do"+f,b.setAttribute("data-object",f),b.value=neko.helper.conversion.hexToString(e.hex),c=document.createElement("small"),c.innerText=e.hex,d.appendChild(b),d.appendChild(c),d.appendChild(document.createElement("hr"))}document.body.appendChild(d)},neko.replace=function(a){var b,c;for(c=0;c<neko.replace.list.length;c++)if(b=neko.replace.list[c],a.trim()===b.findHex)return{replaced:!0,hex:b.newHex};return{replaced:!1,hex:a}},neko.replace.list=[],neko.replace.add=function(a,b,c){var d=neko.helper.conversion.stringToHex(a),e=neko.helper.conversion.stringToHex(b);neko.replace.list.push({name:c||"",findHex:d,newHex:e})},neko.save=function(){var a;fullData=[];for(var b=0;b<neko.output.parsedData.length;b++)if(a=null,neko.output.parsedData[b].garbage)fullData.push(neko.output.parsedData[b].data);else if(neko.output.parsedData[b].changed){a=neko.helper.conversion.stringToHex(neko.helper.wrapLines(document.getElementById("do"+b).value)).split(" ");for(var c=0;c<a.length;c++)a[c]=neko.helper.conversion.hexToInt(a[c]);a.push(0),fullData.push(new Uint8Array(neko.helper.getWordFromLength(a.length).concat(a)))}else fullData.push(new Uint8Array(neko.helper.getWordFromLength(neko.output.parsedData[b].length))),fullData.push(neko.output.parsedData[b].data);return neko.output.createdBlob=new Blob(fullData),saveAs(neko.output.createdBlob,document.getElementById("filename").value),neko.output.createdBlob},neko.set={part:function(a,b){var c=neko.helper.getLengthFromWord(a.subarray(b,b+4)),d=a.subarray(b+4,b+4+c);return{length:c,changed:!1,garbage:!1,important:c>1&&neko.filter(d),data:d}},garbage:function(a,b,c){return{changed:!1,garbage:!0,important:!1,data:a.subarray(b,c)}}};